name: Build Pet Clinic App
on:
  push:
    branches:
    - main
jobs:
    prepare-integration-env:
      runs-on: ubuntu-latest
      env:
        TF_VAR_AZ_SUB: ${{ secrets.AZ_SUB }}
        TF_VAR_AZ_TENANT: ${{ secrets.AZ_TENANT }}
        TF_VAR_AZ_ID: ${{ secrets.AZ_ID }}
        TF_VAR_AZ_SECRET: ${{ secrets.AZ_SECRET }}
      steps:
      - uses: hashicorp/setup-terraform@v1
      - name: Clone Terraform Repo
        id: clone-ops
        uses: actions/checkout@v2        
        with:
          repository: 'rattisyam/iaac'
          ref: 'main'
          token: ${{ secrets.GITOPS_TOKEN }}
      - run: pwd
      - run: ls -l

      - name: Execute Terraform Templates     
        run: |
          cd ./integrations;
          terraform init
          terraform validate
          terraform plan
          terraform apply -auto-approve
        
      
     
        




